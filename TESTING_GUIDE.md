# 테스트 가이드 (Testing Guide)

이 문서는 실버 케어 AI 프로젝트의 기능을 테스트하는 방법을 안내합니다.

## 📋 테스트 전 준비사항

### 1. 환경 변수 설정

프로젝트 루트에 `.env.local` 파일을 생성하고 API 키를 설정하세요:

```bash
# .env.local
NEXT_PUBLIC_OPENAI_API_KEY=your_openai_api_key_here
NEXT_PUBLIC_ELEVENLABS_API_KEY=your_elevenlabs_api_key_here
```

#### API 키 발급 방법:

1. **OpenAI API Key**
   - https://platform.openai.com/api-keys 접속
   - 계정 생성 또는 로그인
   - "Create new secret key" 클릭
   - 키 복사하여 `.env.local`에 붙여넣기

2. **ElevenLabs API Key**
   - https://elevenlabs.io/app/settings/api-keys 접속
   - 계정 생성 또는 로그인
   - API 키 생성 또는 복사
   - 키 복사하여 `.env.local`에 붙여넣기

> **참고**: API 키가 없어도 Mock 모드로 동작하지만, 실제 기능을 테스트하려면 API 키가 필요합니다.

### 2. 의존성 설치 확인

```bash
npm install
```

### 3. 개발 서버 실행

```bash
npm run dev
```

브라우저에서 http://localhost:3000 접속

---

## 📱 모바일 및 원격 테스트 방법 (추천)

이 프로젝트는 모바일 환경이 중요하므로, 실제 스마트폰에서 테스트하는 것을 권장합니다.

### 방법 1: 같은 와이파이(Wi-Fi)에서 테스트 (로컬 네트워크)
PC와 스마트폰이 같은 와이파이 네트워크에 연결되어 있어야 합니다.

1. **내 PC의 내부 IP 주소 확인**:
   - Mac: 터미널에 `ipconfig getifaddr en0` (또는 `ifconfig`로 확인) 입력
   - (예: `192.168.0.10`)

2. **스마트폰 브라우저에서 접속**:
   - 주소창에 `http://[내PC_IP주소]:3000` 입력
   - 예: `http://192.168.0.10:3000`

> **주의**: 마이크 권한은 보안상 `localhost` 또는 `https`에서만 동작할 수 있습니다. 로컬 IP 접속 시 마이크 권한 오류가 발생하면 **방법 2(Vercel 배포)**를 사용하세요.

### 방법 2: Vercel 배포 (가장 확실한 방법)
무료로 호스팅하여 어디서든 접속하고 HTTPS 환경에서 완벽하게 테스트할 수 있습니다.

1. `vercel` CLI 설치 (없을 경우):
   ```bash
   npm i -g vercel
   ```
2. 배포 명령어 실행:
   ```bash
   vercel
   ```
   (모든 질문에 엔터 입력)

3. 배포된 URL로 스마트폰에서 접속.

---

## 🧪 기능별 테스트 방법

### 테스트 1: 목소리 등록 (온보딩)

1. **홈 화면에서 "목소리 등록하기" 클릭**

2. **서비스 이용 동의**
   - 동의 내용 확인
   - "동의하고 시작하기" 클릭

3. **부모/자식 선택**
   - "자녀의 목소리" 또는 "부모의 목소리" 선택
   - (테스트 권장: 자녀 목소리 먼저 등록)

4. **목소리 등록**
   - 이름 입력 (선택사항, 예: "철수", "엄마")
   - "녹음하기" 클릭
   - 마이크 권한 허용
   - **최소 30초 이상** (1분 이상 권장) 평소 말투로 자연스럽게 읽기
   - 예시 문장: 
     ```
     안녕하세요. 저는 오늘 날씨가 좋아서 기분이 좋습니다. 
     가족들과 함께 시간을 보내는 것이 가장 행복합니다.
     ```
   - "녹음 완료" 클릭
   - 처리 중... (목소리 모델 생성 중)
   - "등록 완료!" 확인

**예상 결과:**
- ✅ 목소리가 성공적으로 등록됨
- ✅ "등록 완료!" 화면 표시
- ❌ API 키가 없으면 "등록 실패" 화면 표시 (Mock 모드에서는 등록은 되지만 실제 클론은 안 됨)

---

### 테스트 2: AI 채팅

**전제 조건**: 자녀의 목소리가 등록되어 있어야 함

1. **홈 화면에서 "대화 시작하기" 클릭**

2. **목소리 미등록 시**
   - "먼저 목소리를 등록해주세요" 메시지 표시
   - 버튼 비활성화 확인

3. **대화 시작**
   - "🗣️ 대화 시작하기" 버튼 클릭
   - 마이크 권한 허용
   - **3-5초간 말하기** (예: "엄마, 오늘 날씨가 참 좋네요. 산책 다녀오셨어요?")
   - "👂 듣고 있어요... (누르면 중지)" 버튼 클릭하여 녹음 중지

4. **대화 진행 과정 확인**
   - "생각하는 중... 🤔" 표시
   - 사용자 메시지가 채팅창에 표시됨
   - AI 응답이 텍스트로 표시됨
   - "🔊 말하는 중..." 버튼 표시
   - **등록된 자녀 목소리로 음성 응답 재생**

**예상 결과:**
- ✅ 사용자 음성이 텍스트로 변환됨 (STT)
- ✅ AI가 적절한 응답 생성 (LLM)
- ✅ 자녀 목소리로 음성 응답 재생 (TTS)
- ❌ API 키 없으면 Mock 응답만 표시됨

---

### 테스트 3: 알림 설정 및 음성 알림

1. **홈 화면에서 "설정" 클릭**

2. **알림 추가**
   - "⏰ 알림" 탭 확인
   - 시간 설정 (예: 현재 시간 + 1분)
   - 메시지 선택 (예: "약 드실 시간이에요")
   - "➕ 알림 추가하기" 클릭

3. **알림 목록 확인**
   - 추가한 알림이 목록에 표시됨
   - 켜짐/꺼짐 토글 버튼 확인
   - 삭제 버튼 확인

4. **음성 알림 테스트**
   - 설정한 시간까지 대기 (또는 시간을 현재 시간 + 1초로 설정)
   - 알림 시간이 되면:
     - **등록된 목소리로 알림 메시지 음성 재생**
     - (부모 목소리 우선, 없으면 자식 목소리 사용)

**예상 결과:**
- ✅ 알림이 시간에 맞춰 트리거됨
- ✅ 등록된 목소리로 음성 재생
- ❌ 목소리가 없으면 텍스트 알림만 표시

---

### 테스트 4: 목소리 관리

1. **설정 페이지에서 "🎙️ 목소리" 탭 클릭**

2. **등록된 목소리 확인**
   - 등록한 목소리 프로필 표시
   - 역할 (부모/자식) 확인
   - 이름 확인
   - 등록일 확인
   - 등록 상태 (✅ 등록 완료 / ❌ 등록 실패) 확인

3. **목소리 재등록**
   - "재등록" 버튼 클릭
   - 온보딩 페이지로 이동

4. **목소리 삭제**
   - "삭제" 버튼 클릭
   - 확인 대화상자에서 확인
   - 목록에서 제거 확인

---

## 🔍 Mock 모드 테스트 (API 키 없이)

API 키 없이도 Mock 모드로 기본 UI와 플로우를 테스트할 수 있습니다:

1. **환경 변수 설정하지 않고 서버 실행**
   ```bash
   npm run dev
   ```

2. **Mock 모드 특징:**
   - 목소리 등록: 등록 완료되지만 실제 클론은 안 됨 (에러 발생 가능)
   - 채팅: 고정된 Mock 응답 표시
   - 알림: 텍스트 알림만 표시

3. **브라우저 콘솔 확인:**
   - API 키 없음 경고 메시지 확인
   - Mock 모드 사용 안내 확인

---

## 🐛 문제 해결

### 문제 1: 마이크 접근 권한 오류
- **해결**: 
  - 브라우저 설정에서 마이크 권한 허용
  - **중요**: 로컬 네트워크(IP)로 접속 시 HTTP에서는 마이크 권한이 차단될 수 있습니다. Vercel 배포(HTTPS)를 권장합니다.

### 문제 2: 목소리 등록 실패
- **확인 사항:**
  - API 키가 올바르게 설정되었는지 확인
  - 녹음이 30초 이상인지 확인
  - 네트워크 연결 확인
  - 브라우저 콘솔의 에러 메시지 확인

### 문제 3: 음성 응답이 재생되지 않음
- **확인 사항:**
  - 목소리가 제대로 등록되었는지 확인 (설정 → 목소리 탭)
  - 브라우저 콘솔의 에러 메시지 확인
  - 브라우저 오디오 재생 권한 확인

### 문제 4: STT가 음성을 인식하지 못함
- **확인 사항:**
  - 마이크가 정상 작동하는지 확인
  - 조용한 환경에서 녹음했는지 확인
  - 녹음 시간이 너무 짧지 않은지 확인 (최소 2-3초)

---

## 📝 테스트 체크리스트

- [ ] 환경 변수 설정 완료
- [ ] 개발 서버 정상 실행
- [ ] 스마트폰/Vercel 환경에서 접속 확인
- [ ] 자녀 목소리 등록 성공
- [ ] 부모 목소리 등록 성공
- [ ] AI 채팅에서 음성 인식 정상 작동
- [ ] AI 채팅에서 자녀 목소리로 응답 재생
- [ ] 알림 추가 및 삭제 기능 정상
- [ ] 알림 시간에 맞춰 음성 알림 재생
- [ ] 설정 페이지에서 목소리 관리 기능 정상

---

## 💡 추가 테스트 시나리오

### 시나리오 1: 여러 명의 목소리 등록
- 부모 목소리 1개, 자식 목소리 1개 등록
- 각각 다른 이름으로 등록
- 설정에서 모두 확인

### 시나리오 2: 긴 대화 테스트
- AI 채팅에서 여러 번 대화 이어가기
- 대화 히스토리 정상 표시 확인
- 음성 응답이 모두 정상 재생되는지 확인

### 시나리오 3: 여러 알림 설정
- 하루에 여러 시간대 알림 설정
- 각각 다른 메시지로 설정
- 모두 정상 작동하는지 확인

---

## 🚀 프로덕션 빌드 테스트

로컬에서 프로덕션 빌드를 테스트하려면:

```bash
npm run build
npm start
```

그런 다음 http://localhost:3000 접속

---

**테스트 중 문제가 발생하면 브라우저 콘솔(F12)의 에러 메시지를 확인하세요!**
